<!DOCTYPE html>
<html lang="vi">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>ZaloPay Payment Test Interface</title>
		<!-- Link Inter Font -->
		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
			rel="stylesheet"
		/>
		<style>
			body {
				background: #f5f7fa;
				min-height: 100vh;
				font-family: 'Inter', -apple-system, BlinkMacSystemFont,
					'Segoe UI', Roboto, sans-serif;
				color: #333;
			}
			.main-container {
				background: white;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
				margin: 20px auto;
				max-width: 1200px;
				overflow: hidden;
			}
			.header {
				background: #2c3e50;
				color: white;
				padding: 24px 32px;
				text-align: center;
				border-bottom: 1px solid #34495e;
			}
			.header h1 {
				margin: 0;
				font-size: 1.8rem;
				font-weight: 600;
			}
			.header p {
				margin: 8px 0 0 0;
				opacity: 0.9;
				font-size: 0.95rem;
			}
			.content {
				padding: 32px;
			}
			.token-section {
				background: #f8f9fa;
				border: 1px solid #e9ecef;
				border-radius: 6px;
				padding: 24px;
				margin-bottom: 24px;
			}
			.token-section h3 {
				margin: 0 0 8px 0;
				font-size: 1.1rem;
				font-weight: 600;
				color: #2c3e50;
			}
			.token-section p {
				margin: 0 0 16px 0;
				color: #6c757d;
				font-size: 0.9rem;
			}
			.booking-card {
				background: white;
				border: 1px solid #e9ecef;
				border-radius: 6px;
				margin-bottom: 16px;
				transition: box-shadow 0.2s ease;
			}
			.booking-card:hover {
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
			}
			.booking-header {
				background: #34495e;
				color: white;
				padding: 16px 20px;
				border-bottom: 1px solid #2c3e50;
			}
			.booking-header h5 {
				margin: 0;
				font-size: 1.1rem;
				font-weight: 600;
			}
			.booking-header small {
				opacity: 0.8;
			}
			.booking-body {
				padding: 20px;
			}
			.status-badge {
				padding: 4px 12px;
				border-radius: 4px;
				font-size: 0.8rem;
				font-weight: 500;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}
			.status-pending {
				background: #fff3cd;
				color: #856404;
				border: 1px solid #ffeaa7;
			}
			.status-confirmed {
				background: #d4edda;
				color: #155724;
				border: 1px solid #c3e6cb;
			}
			.status-cancelled {
				background: #f8d7da;
				color: #721c24;
				border: 1px solid #f5c6cb;
			}
			.payment-btn {
				background: #007bff;
				border: 1px solid #007bff;
				border-radius: 4px;
				padding: 8px 16px;
				color: white;
				font-weight: 500;
				font-size: 0.9rem;
				transition: all 0.2s ease;
			}
			.payment-btn:hover {
				background: #0056b3;
				border-color: #0056b3;
				color: white;
			}
			.payment-btn:disabled {
				background: #6c757d;
				border-color: #6c757d;
				cursor: not-allowed;
			}
			.loading {
				display: none;
				text-align: center;
				padding: 40px;
			}
			.loading.show {
				display: block;
			}
			.alert {
				border-radius: 4px;
				border: 1px solid transparent;
				margin-bottom: 16px;
			}
			.form-control {
				border-radius: 4px;
				border: 1px solid #ced4da;
				padding: 8px 12px;
				font-size: 0.9rem;
			}
			.form-control:focus {
				border-color: #007bff;
				box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
			}
			.btn-primary {
				background: #007bff;
				border: 1px solid #007bff;
				border-radius: 4px;
				padding: 8px 16px;
				font-weight: 500;
				font-size: 0.9rem;
			}
			.btn-primary:hover {
				background: #0056b3;
				border-color: #0056b3;
			}
			.btn-outline-secondary {
				border: 1px solid #6c757d;
				color: #6c757d;
				border-radius: 4px;
				padding: 6px 12px;
				font-size: 0.8rem;
			}
			.btn-outline-secondary:hover {
				background: #6c757d;
				border-color: #6c757d;
				color: white;
			}
			.btn-outline-danger {
				border: 1px solid #dc3545;
				color: #dc3545;
				border-radius: 4px;
				padding: 6px 12px;
				font-size: 0.8rem;
			}
			.btn-outline-danger:hover {
				background: #dc3545;
				border-color: #dc3545;
				color: white;
			}
			.btn-outline-primary {
				border: 1px solid #007bff;
				color: #007bff;
				border-radius: 4px;
				padding: 6px 12px;
				font-size: 0.8rem;
			}
			.btn-outline-primary:hover {
				background: #007bff;
				border-color: #007bff;
				color: white;
			}
			.payment-history {
				background: #f8f9fa;
				border: 1px solid #e9ecef;
				border-radius: 6px;
				padding: 24px;
				margin-top: 24px;
			}
			.payment-history h3 {
				margin: 0 0 16px 0;
				font-size: 1.1rem;
				font-weight: 600;
				color: #2c3e50;
			}
			.payment-item {
				background: white;
				border: 1px solid #e9ecef;
				border-radius: 4px;
				padding: 16px;
				margin-bottom: 12px;
			}
			.no-data {
				text-align: center;
				padding: 40px 20px;
				color: #6c757d;
			}
			.no-data i {
				font-size: 3rem;
				margin-bottom: 16px;
				opacity: 0.5;
			}
			.no-data h4 {
				margin: 0 0 8px 0;
				font-size: 1.1rem;
				font-weight: 600;
			}
			.no-data p {
				margin: 0;
				font-size: 0.9rem;
			}
			/* Typography improvements */
			h3 {
				font-size: 1.2rem;
				font-weight: 600;
				color: #2c3e50;
				margin-bottom: 16px;
			}
			strong {
				font-weight: 600;
				color: #2c3e50;
			}
			.text-muted {
				color: #6c757d !important;
			}
			.text-success {
				color: #28a745 !important;
			}
			/* Responsive improvements */
			@media (max-width: 768px) {
				.main-container {
					margin: 10px;
					border-radius: 0;
				}
				.content {
					padding: 20px;
				}
				.header {
					padding: 20px;
				}
				.header h1 {
					font-size: 1.5rem;
				}
			}

			.booking-header div {
				display: flex;
				justify-content: start;
				align-items: center;
				gap: 10px;
			}

			.booking-body div {
				display: flex;
				flex-direction: column;
				justify-content: start;
				align-items: start;
				gap: 4px;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<div class="main-container">
				<div class="header">
					<h1>
						<i class="fas fa-credit-card"></i> ZaloPay Payment Test
					</h1>
					<p>Flight Booking System - Payment Testing Interface</p>
				</div>

				<div class="content">
					<!-- Instructions Section -->
					<div class="token-section">
						<h3>
							<i class="fas fa-info-circle"></i> How to Test
							ZaloPay Payment Flow
						</h3>
						<div class="alert alert-info">
							<h5>
								<i class="fas fa-play-circle"></i> Testing
								Steps:
							</h5>
							<ol>
								<li>
									<strong>Load Bookings:</strong> Click "Load
									Bookings" to see available bookings
								</li>
								<li>
									<strong>Create Payment:</strong> Click "Pay
									with ZaloPay" to create a ZaloPay payment
								</li>
								<li>
									<strong>Test Success:</strong> Click "Test
									Success" to simulate successful payment
								</li>
								<li>
									<strong>View Results:</strong> Check booking
									status and payment history
								</li>
							</ol>
							<p class="mb-0">
								<strong>Note:</strong> The system will
								automatically update booking status to
								"Confirmed" and payment status to "Paid" after
								successful payment.
							</p>
						</div>
					</div>

					<!-- Token Input Section -->
					<div class="token-section">
						<h3><i class="fas fa-key"></i> Authentication</h3>
						<p class="text-muted">
							Enter JWT token to authenticate and load bookings
						</p>

						<div
							class="row"
							style="
								display: flex;
								align-items: center;
								justify-content: space-between;
							"
						>
							<div class="col-md-8">
								<div class="input-group">
									<span class="input-group-text">
										<i class="fas fa-lock"></i>
									</span>
									<input
										type="text"
										class="form-control"
										id="jwtToken"
										placeholder="Enter your JWT token..."
										value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaWF0IjoxNzU3OTA5NjIyLCJleHAiOjE3NTc5OTYwMjJ9.eY7Ry0GNp0kQe1zM2BXgGpd80gLPQfwelNltHz7ePt4"
									/>
								</div>
							</div>
							<div class="col-md-4">
								<button
									class="btn btn-primary w-100"
									style="color: #fff; cursor: pointer"
									onclick="loadBookings()"
								>
									<i class="fas fa-search"></i> Load Bookings
								</button>
							</div>
						</div>

						<div class="mt-3">
							<small class="text-muted">
								<i class="fas fa-info-circle"></i>
								Default test user: test@flightbooking.com /
								test123
							</small>
						</div>
					</div>

					<!-- Loading Indicator -->
					<div class="loading" id="loadingIndicator">
						<div class="spinner-border text-primary" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
						<p class="mt-2">Loading data...</p>
					</div>

					<!-- Alert Messages -->
					<div id="alertContainer"></div>

					<!-- Bookings Section -->
					<div id="bookingsSection" style="display: none">
						<h3><i class="fas fa-plane"></i> Bookings List</h3>
						<div id="bookingsList"></div>
					</div>

					<!-- Payment History Section -->
					<div id="paymentHistorySection" style="display: none">
						<div class="payment-history">
							<h3>
								<i class="fas fa-history"></i> Payment History
							</h3>
							<div id="paymentHistoryList"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			const API_BASE_URL = 'http://localhost:3000/api';
			let currentToken = '';

			// Show alert function
			function showAlert(message, type = 'info') {
				const alertContainer =
					document.getElementById('alertContainer');
				const alertId = 'alert-' + Date.now();

				const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" id="${alertId}" role="alert">
                    <i class="fas fa-${
						type === 'success'
							? 'check-circle'
							: type === 'danger'
							? 'exclamation-triangle'
							: 'info-circle'
					}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;

				alertContainer.innerHTML = alertHtml;

				// Auto dismiss after 5 seconds
				setTimeout(() => {
					const alert = document.getElementById(alertId);
					if (alert) {
						alert.remove();
					}
				}, 5000);
			}

			// Load bookings function
			async function loadBookings() {
				const token = document.getElementById('jwtToken').value.trim();

				if (!token) {
					showAlert('Please enter JWT token!', 'warning');
					return;
				}

				currentToken = token;
				showLoading(true);
				hideSections();

				try {
					// Load bookings directly from bookings API
					const response = await fetch(
						`${API_BASE_URL}/bookings?page=1&limit=50`,
						{
							method: 'GET',
							headers: {
								Authorization: `Bearer ${token}`,
								'Content-Type': 'application/json',
							},
						}
					);

					if (!response.ok) {
						throw new Error(
							`HTTP ${response.status}: ${response.statusText}`
						);
					}

					const data = await response.json();

					if (data.success) {
						displayBookings(data.data.bookings);
						showAlert(
							`Loaded ${data.data.bookings.length} bookings successfully!`,
							'success'
						);
					} else {
						throw new Error(data.message || 'Unable to load data');
					}
				} catch (error) {
					console.error('Error loading bookings:', error);
					showAlert(`Error: ${error.message}`, 'danger');
				} finally {
					showLoading(false);
				}
			}

			// Display bookings
			function displayBookings(bookings) {
				const bookingsList = document.getElementById('bookingsList');

				if (!bookings || bookings.length === 0) {
					bookingsList.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-inbox"></i>
                        <h4>No Bookings Found</h4>
                        <p>This user has no bookings available for payment.</p>
                    </div>
                `;
				} else {
					let html = '';
					bookings.forEach((booking) => {
						// Get flight details from booking details
						const flightInfo =
							booking.BookingDetails &&
							booking.BookingDetails.length > 0
								? booking.BookingDetails[0].Flight
								: null;

						html += `
                        <div class="booking-card">
                            <div class="booking-header">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <h5 class="mb-0">
                                            <i class="fas fa-plane"></i> Booking ${
												booking.booking_reference
											}
                                        </h5>
                                        <small>ID: ${booking.booking_id}</small>
                                    </div>
                                    <div class="col-md-6 text-end">
                                        <span class="status-badge status-${
											booking.status
										}">
                                            ${getStatusText(booking.status)}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="booking-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="row mb-3">
                                            <div class="col-sm-6">
                                                <strong><i class="fas fa-calendar"></i> Booking Date:</strong><br>
                                                <span class="text-muted">${formatDate(
													booking.booking_date
												)}</span>
                                            </div>
                                            <div class="col-sm-6">
                                                <strong><i class="fas fa-money-bill-wave"></i> Total Amount:</strong><br>
                                                <span class="text-success fw-bold">${formatCurrency(
													booking.total_amount
												)} VND</span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-sm-6">
                                                <strong><i class="fas fa-envelope"></i> Email:</strong><br>
                                                <span class="text-muted">${
													booking.contact_email ||
													'N/A'
												}</span>
                                            </div>
                                            <div class="col-sm-6">
                                                <strong><i class="fas fa-phone"></i> Phone:</strong><br>
                                                <span class="text-muted">${
													booking.contact_phone ||
													'N/A'
												}</span>
                                            </div>
                                        </div>
                                        ${
											flightInfo
												? `
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <strong><i class="fas fa-plane-departure"></i> Flight:</strong><br>
                                                <span class="text-muted">${
													flightInfo.flight_number
												}</span>
                                            </div>
                                            <div class="col-sm-6">
                                                <strong><i class="fas fa-clock"></i> Departure:</strong><br>
                                                <span class="text-muted">${formatDate(
													flightInfo.departure_time
												)}</span>
                                            </div>
                                        </div>
                                        `
												: ''
										}
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <div class="d-grid gap-2">
                                            <button class="btn payment-btn"
                                                    onclick="createPayment(${
														booking.booking_id
													}, '${
							booking.booking_reference
						}', ${booking.total_amount})"
                                                    ${
														booking.status ===
															'confirmed' ||
														booking.status ===
															'cancelled'
															? 'disabled'
															: ''
													}>
                                                <i class="fas fa-credit-card"></i>
                                                ${
													booking.status ===
													'confirmed'
														? 'Paid'
														: booking.status ===
														  'cancelled'
														? 'Cancelled'
														: 'Pay with ZaloPay'
												}
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm"
                                                    onclick="viewPaymentHistory(${
														booking.booking_id
													})">
                                                <i class="fas fa-history"></i> Payment History
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm"
                                                    onclick="testPaymentSuccess(${
														booking.booking_id
													}, '${
							booking.booking_reference
						}', ${booking.total_amount})">
                                                <i class="fas fa-check-circle"></i> Test Success
                                            </button>
                                            ${
												booking.status === 'pending'
													? `
                                            <button class="btn btn-outline-danger btn-sm"
                                                    onclick="cancelBooking(${booking.booking_id})">
                                                <i class="fas fa-times"></i> Cancel Booking
                                            </button>
                                            `
													: ''
											}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
					});

					bookingsList.innerHTML = html;
				}

				document.getElementById('bookingsSection').style.display =
					'block';
			}

			// Create payment function
			async function createPayment(bookingId, bookingReference, amount) {
				if (!currentToken) {
					showAlert('Please enter JWT token first!', 'warning');
					return;
				}

				showLoading(true);

				try {
					const response = await fetch(
						`${API_BASE_URL}/payments/zalopay/create`,
						{
							method: 'POST',
							headers: {
								Authorization: `Bearer ${currentToken}`,
								'Content-Type': 'application/json',
							},
							body: JSON.stringify({
								booking_id: bookingId,
							}),
						}
					);

					const data = await response.json();

					if (data.success) {
						const zalopayUrl = data.data.payment_url;
						window.open(zalopayUrl, '_blank');
					} else {
						throw new Error(
							data.message || 'Unable to create payment'
						);
					}
				} catch (error) {
					console.error('Error creating payment:', error);
					showAlert(
						`Error creating payment: ${error.message}`,
						'danger'
					);
				} finally {
					showLoading(false);
				}
			}

			// View payment history for a specific booking
			async function viewPaymentHistory(bookingId) {
				if (!currentToken) {
					showAlert('Please enter JWT token first!', 'warning');
					return;
				}

				showLoading(true);

				try {
					const response = await fetch(
						`${API_BASE_URL}/payments/history?page=1&limit=50`,
						{
							method: 'GET',
							headers: {
								Authorization: `Bearer ${currentToken}`,
								'Content-Type': 'application/json',
							},
						}
					);

					const data = await response.json();

					if (data.success) {
						const bookingPayments = data.data.payments.filter(
							(p) => p.booking_id === bookingId
						);
						displayPaymentHistory(bookingPayments);
					} else {
						throw new Error(
							data.message || 'Unable to load payment history'
						);
					}
				} catch (error) {
					console.error('Error loading payment history:', error);
					showAlert(
						`Error loading history: ${error.message}`,
						'danger'
					);
				} finally {
					showLoading(false);
				}
			}

			// Display payment history
			function displayPaymentHistory(payments) {
				const paymentHistoryList =
					document.getElementById('paymentHistoryList');

				if (!payments || payments.length === 0) {
					paymentHistoryList.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-receipt"></i>
                        <h4>No Payment History</h4>
                        <p>This booking has no payment records yet.</p>
                    </div>
                `;
				} else {
					let html = '';
					payments.forEach((payment) => {
						html += `
                        <div class="payment-item">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <strong>Payment ID:</strong> ${
										payment.payment_id
									}<br>
                                    <strong>Reference:</strong> ${
										payment.payment_reference
									}
                                </div>
                                <div class="col-md-3">
                                    <strong>Method:</strong> ${payment.payment_method.toUpperCase()}<br>
                                    <strong>Amount:</strong> ${formatCurrency(
										payment.amount
									)} VND
                                </div>
                                <div class="col-md-3">
                                    <strong>Status:</strong>
                                    <span class="status-badge status-${
										payment.status
									}">
                                        ${getPaymentStatusText(payment.status)}
                                    </span><br>
                                    <strong>Date:</strong> ${formatDate(
										payment.payment_date
									)}
                                </div>
                                <div class="col-md-3 text-end">
                                    <button class="btn btn-outline-primary btn-sm"
                                            onclick="checkPaymentStatus('${
												payment.payment_reference
											}')">
                                        <i class="fas fa-search"></i> Check Status
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
					});

					paymentHistoryList.innerHTML = html;
				}

				document.getElementById('paymentHistorySection').style.display =
					'block';
			}

			// Check payment status
			async function checkPaymentStatus(appTransId) {
				if (!currentToken) {
					showAlert('Please enter JWT token first!', 'warning');
					return;
				}

				showLoading(true);

				try {
					const response = await fetch(
						`${API_BASE_URL}/payments/zalopay/status`,
						{
							method: 'POST',
							headers: {
								Authorization: `Bearer ${currentToken}`,
								'Content-Type': 'application/json',
							},
							body: JSON.stringify({
								app_trans_id: appTransId,
							}),
						}
					);

					const data = await response.json();

					if (data.success) {
						const status = data.data.status;
						const message = `
                        <strong>App Trans ID:</strong> ${data.data.app_trans_id}<br>
                        <strong>ZaloPay Status:</strong> ${status.return_message}<br>
                        <strong>Local Status:</strong> ${data.data.local_status}<br>
                        <strong>Booking Status:</strong> ${data.data.booking_status}
                    `;
						showAlert(message, 'info');
					} else {
						throw new Error(
							data.message || 'Unable to check payment status'
						);
					}
				} catch (error) {
					console.error('Error checking payment status:', error);
					showAlert(
						`Error checking status: ${error.message}`,
						'danger'
					);
				} finally {
					showLoading(false);
				}
			}

			// Test payment success function
			async function testPaymentSuccess(
				bookingId,
				bookingReference,
				amount
			) {
				if (!currentToken) {
					showAlert('Please enter JWT token first!', 'warning');
					return;
				}

				// First create a payment record
				showLoading(true);

				try {
					// Create payment first
					const createResponse = await fetch(
						`${API_BASE_URL}/payments/zalopay/create`,
						{
							method: 'POST',
							headers: {
								Authorization: `Bearer ${currentToken}`,
								'Content-Type': 'application/json',
							},
							body: JSON.stringify({
								booking_id: bookingId,
							}),
						}
					);

					const createData = await createResponse.json();

					if (createData.success) {
						const appTransId = createData.data.app_trans_id;

						// Generate test URL for payment success
						const testUrl = `http://localhost:3000/payment/success?appid=553&apptransid=${appTransId}&pmcid=38&bankcode=zalopayapp&amount=${amount}&discountamount=0&status=1&checksum=test`;

						showAlert(
							`Payment created with App Trans ID: ${appTransId}<br><br>Click the link below to test payment success:<br><br><a href="${testUrl}" target="_blank" style="color: #007bff; text-decoration: underline;">Test Payment Success</a>`,
							'success'
						);

						// Auto-open test URL after 2 seconds
						setTimeout(() => {
							window.open(testUrl, '_blank');
						}, 2000);
					} else {
						throw new Error(
							createData.message || 'Unable to create payment'
						);
					}
				} catch (error) {
					console.error('Error testing payment success:', error);
					showAlert(`Error: ${error.message}`, 'danger');
				} finally {
					showLoading(false);
				}
			}

			// Cancel booking function
			async function cancelBooking(bookingId) {
				if (!currentToken) {
					showAlert('Please enter JWT token first!', 'warning');
					return;
				}

				const reason = prompt('Enter cancellation reason (optional):');
				if (reason === null) return; // User cancelled

				showLoading(true);

				try {
					const response = await fetch(
						`${API_BASE_URL}/bookings/${bookingId}/cancel`,
						{
							method: 'PATCH',
							headers: {
								Authorization: `Bearer ${currentToken}`,
								'Content-Type': 'application/json',
							},
							body: JSON.stringify({
								reason: reason || 'Cancelled by user',
							}),
						}
					);

					const data = await response.json();

					if (data.success) {
						showAlert('Booking cancelled successfully!', 'success');
						// Reload bookings to show updated status
						setTimeout(() => {
							loadBookings();
						}, 2000);
					} else {
						throw new Error(
							data.message || 'Unable to cancel booking'
						);
					}
				} catch (error) {
					console.error('Error cancelling booking:', error);
					showAlert(
						`Error cancelling booking: ${error.message}`,
						'danger'
					);
				} finally {
					showLoading(false);
				}
			}

			// Utility functions
			function showLoading(show) {
				document.getElementById('loadingIndicator').style.display = show
					? 'block'
					: 'none';
			}

			function hideSections() {
				document.getElementById('bookingsSection').style.display =
					'none';
				document.getElementById('paymentHistorySection').style.display =
					'none';
			}

			function getStatusText(status) {
				const statusMap = {
					pending: 'Pending',
					confirmed: 'Confirmed',
					cancelled: 'Cancelled',
					completed: 'Completed',
				};
				return statusMap[status] || status;
			}

			function getPaymentStatusText(status) {
				const statusMap = {
					pending: 'Pending',
					completed: 'Completed',
					failed: 'Failed',
					refunded: 'Refunded',
				};
				return statusMap[status] || status;
			}

			function formatDate(dateString) {
				if (!dateString) return 'N/A';
				const date = new Date(dateString);
				return date.toLocaleString('vi-VN');
			}

			function formatCurrency(amount) {
				return new Intl.NumberFormat('vi-VN').format(amount);
			}

			// Auto-load on page load if token is present
			document.addEventListener('DOMContentLoaded', function () {
				const tokenInput = document.getElementById('jwtToken');
				if (tokenInput.value.trim()) {
					// Auto-load after 1 second
					setTimeout(() => {
						loadBookings();
					}, 1000);
				}
			});
		</script>
	</body>
</html>
