<!DOCTYPE html>
<html lang="vi">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>AI Flight Recommendation Test Interface</title>
		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
			rel="stylesheet"
		/>
		<style>
			body {
				background: #f5f7fa;
				min-height: 100vh;
				font-family: 'Inter', -apple-system, BlinkMacSystemFont,
					'Segoe UI', Roboto, sans-serif;
				color: #333;
			}
			.main-container {
				background: white;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
				margin: 20px auto;
				max-width: 1400px;
				overflow: hidden;
			}
			.header {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				padding: 24px 32px;
				text-align: center;
			}
			.header h1 {
				margin: 0;
				font-size: 1.8rem;
				font-weight: 600;
			}
			.content {
				padding: 32px;
			}
			.section {
				background: #f8f9fa;
				border: 1px solid #e9ecef;
				border-radius: 6px;
				padding: 24px;
				margin-bottom: 24px;
			}
			.section h3 {
				margin: 0 0 16px 0;
				font-size: 1.2rem;
				font-weight: 600;
				color: #2c3e50;
			}
			.test-card {
				background: white;
				border: 1px solid #e9ecef;
				border-radius: 6px;
				margin-bottom: 16px;
				transition: box-shadow 0.2s ease;
			}
			.test-card:hover {
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
			}
			.test-header {
				background: #34495e;
				color: white;
				padding: 16px 20px;
				border-bottom: 1px solid #2c3e50;
			}
			.test-body {
				padding: 20px;
			}
			.btn-primary {
				background: #007bff;
				border: 1px solid #007bff;
				border-radius: 4px;
				padding: 8px 16px;
				font-weight: 500;
				font-size: 0.9rem;
			}
			.btn-success {
				background: #28a745;
				border: 1px solid #28a745;
			}
			.btn-info {
				background: #17a2b8;
				border: 1px solid #17a2b8;
			}
			.btn-warning {
				background: #ffc107;
				border: 1px solid #ffc107;
				color: #212529;
			}
			.result-area {
				background: #f8f9fa;
				border: 1px solid #e9ecef;
				border-radius: 4px;
				padding: 16px;
				margin-top: 16px;
				max-height: 400px;
				overflow-y: auto;
			}
			.loading {
				display: none;
				text-align: center;
				padding: 20px;
			}
			.loading.show {
				display: block;
			}
			.alert {
				border-radius: 4px;
				margin-bottom: 16px;
			}
			.form-control {
				border-radius: 4px;
				border: 1px solid #ced4da;
				padding: 8px 12px;
				font-size: 0.9rem;
			}
			.form-control:focus {
				border-color: #007bff;
				box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
			}
			.recommendation-item {
				background: white;
				border: 1px solid #e9ecef;
				border-radius: 4px;
				padding: 16px;
				margin-bottom: 12px;
			}
			.score-badge {
				padding: 4px 8px;
				border-radius: 4px;
				font-size: 0.8rem;
				font-weight: 600;
			}
			.score-high {
				background: #d4edda;
				color: #155724;
			}
			.score-medium {
				background: #fff3cd;
				color: #856404;
			}
			.score-low {
				background: #f8d7da;
				color: #721c24;
			}
			.flight-info {
				display: grid;
				grid-template-columns: 1fr 1fr 1fr;
				gap: 16px;
				margin-top: 12px;
			}
			.flight-detail {
				text-align: center;
			}
			.flight-detail strong {
				display: block;
				color: #2c3e50;
				margin-bottom: 4px;
			}
			.flight-detail span {
				color: #6c757d;
				font-size: 0.9rem;
			}
			@media (max-width: 768px) {
				.main-container {
					margin: 10px;
					border-radius: 0;
				}
				.content {
					padding: 20px;
				}
				.flight-info {
					grid-template-columns: 1fr;
					gap: 8px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container-fluid">
			<div class="main-container">
				<div class="header">
					<h1>
						<i class="fas fa-robot"></i> AI Flight Recommendation
						Test Interface
					</h1>
					<p>Flight Booking System - AI Features Testing</p>
				</div>

				<div class="content">
					<!-- Authentication Section -->
					<div class="section">
						<h3><i class="fas fa-key"></i> Authentication</h3>
						<div class="row align-items-center">
							<div class="col-md-8">
								<div class="input-group">
									<span class="input-group-text"
										><i class="fas fa-lock"></i
									></span>
									<input
										type="text"
										class="form-control"
										id="jwtToken"
										placeholder="Enter your JWT token..."
										value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaWF0IjoxNzU3OTA5NjIyLCJleHAiOjE3NTc5OTYwMjJ9.eY7Ry0GNp0kQe1zM2BXgGpd80gLPQfwelNltHz7ePt4"
									/>
								</div>
							</div>
							<div class="col-md-4">
								<button
									class="btn btn-primary w-100"
									onclick="testConnection()"
								>
									<i class="fas fa-plug"></i> Test Connection
								</button>
							</div>
						</div>
						<small class="text-muted mt-2 d-block">
							<i class="fas fa-info-circle"></i>
							Default test user: test@flightbooking.com / test123
						</small>
					</div>

					<!-- Loading Indicator -->
					<div class="loading" id="loadingIndicator">
						<div class="spinner-border text-primary" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
						<p class="mt-2">Processing AI request...</p>
					</div>

					<!-- Alert Messages -->
					<div id="alertContainer"></div>

					<!-- AI Features Testing -->
					<div class="section">
						<h3>
							<i class="fas fa-brain"></i> AI Features Testing
						</h3>

						<!-- Personalized Recommendations -->
						<div class="test-card">
							<div class="test-header">
								<h5 class="mb-0">
									<i class="fas fa-star"></i> Personalized
									Flight Recommendations
								</h5>
								<small
									>Get AI-powered flight suggestions based on
									user preferences</small
								>
							</div>
							<div class="test-body">
								<div class="row">
									<div class="col-md-3">
										<label class="form-label"
											>Departure Airport</label
										>
										<select
											class="form-control"
											id="departureAirport"
										>
											<option value="SGN">
												SGN - Ho Chi Minh City
											</option>
											<option value="HAN">
												HAN - Hanoi
											</option>
											<option value="DAD">
												DAD - Da Nang
											</option>
											<option value="BKK">
												BKK - Bangkok
											</option>
											<option value="SIN">
												SIN - Singapore
											</option>
										</select>
									</div>
									<div class="col-md-3">
										<label class="form-label"
											>Arrival Airport</label
										>
										<select
											class="form-control"
											id="arrivalAirport"
										>
											<option value="HAN">
												HAN - Hanoi
											</option>
											<option value="SGN">
												SGN - Ho Chi Minh City
											</option>
											<option value="DAD">
												DAD - Da Nang
											</option>
											<option value="BKK">
												BKK - Bangkok
											</option>
											<option value="SIN">
												SIN - Singapore
											</option>
										</select>
									</div>
									<div class="col-md-2">
										<label class="form-label"
											>Departure Date</label
										>
										<input
											type="date"
											class="form-control"
											id="departureDate"
											value="2024-12-20"
										/>
									</div>
									<div class="col-md-2">
										<label class="form-label">Class</label>
										<select
											class="form-control"
											id="travelClass"
										>
											<option value="ECONOMY">
												Economy
											</option>
											<option value="BUSINESS">
												Business
											</option>
										</select>
									</div>
									<div class="col-md-2">
										<label class="form-label">Limit</label>
										<select
											class="form-control"
											id="recommendationLimit"
										>
											<option value="5">5</option>
											<option value="10" selected>
												10
											</option>
											<option value="15">15</option>
											<option value="20">20</option>
										</select>
									</div>
								</div>
								<div class="mt-3">
									<button
										class="btn btn-primary"
										onclick="getPersonalizedRecommendations()"
									>
										<i class="fas fa-magic"></i> Get AI
										Recommendations
									</button>
								</div>
								<div
									class="result-area"
									id="recommendationsResult"
									style="display: none"
								>
									<h6>
										<i class="fas fa-list"></i> AI
										Recommendations
									</h6>
									<div id="recommendationsList"></div>
								</div>
							</div>
						</div>

						<!-- Booking Assistance -->
						<div class="test-card">
							<div class="test-header">
								<h5 class="mb-0">
									<i class="fas fa-hands-helping"></i> AI
									Booking Assistance
								</h5>
								<small
									>Get intelligent booking suggestions and
									tips</small
								>
							</div>
							<div class="test-body">
								<div class="row">
									<div class="col-md-4">
										<label class="form-label"
											>Flight ID</label
										>
										<input
											type="number"
											class="form-control"
											id="bookingFlightId"
											placeholder="Enter flight ID"
											value="1"
										/>
									</div>
									<div class="col-md-4">
										<label class="form-label"
											>Passengers</label
										>
										<select
											class="form-control"
											id="bookingPassengers"
										>
											<option value="1">
												1 Passenger
											</option>
											<option value="2" selected>
												2 Passengers
											</option>
											<option value="3">
												3 Passengers
											</option>
											<option value="4">
												4 Passengers
											</option>
										</select>
									</div>
									<div class="col-md-4">
										<label class="form-label"
											>Travel Class</label
										>
										<select
											class="form-control"
											id="bookingClass"
										>
											<option value="ECONOMY" selected>
												Economy
											</option>
											<option value="BUSINESS">
												Business
											</option>
										</select>
									</div>
								</div>
								<div class="mt-3">
									<button
										class="btn btn-success"
										onclick="getBookingAssistance()"
									>
										<i class="fas fa-lightbulb"></i> Get
										Booking Tips
									</button>
								</div>
								<div
									class="result-area"
									id="bookingAssistanceResult"
									style="display: none"
								>
									<h6>
										<i class="fas fa-info-circle"></i>
										Booking Assistance
									</h6>
									<div id="bookingAssistanceList"></div>
								</div>
							</div>
						</div>

						<!-- User Insights -->
						<div class="test-card">
							<div class="test-header">
								<h5 class="mb-0">
									<i class="fas fa-chart-line"></i> User
									Behavior Insights
								</h5>
								<small
									>Analyze user travel patterns and
									preferences</small
								>
							</div>
							<div class="test-body">
								<div class="row">
									<div class="col-md-6">
										<label class="form-label"
											>Analysis Type</label
										>
										<select
											class="form-control"
											id="insightType"
										>
											<option value="preferences">
												Travel Preferences
											</option>
											<option value="patterns">
												Travel Patterns
											</option>
											<option value="recommendations">
												Recommendation History
											</option>
											<option value="search_history">
												Search History
											</option>
										</select>
									</div>
									<div class="col-md-6">
										<label class="form-label"
											>Time Period (days)</label
										>
										<select
											class="form-control"
											id="insightPeriod"
										>
											<option value="7">
												Last 7 days
											</option>
											<option value="30" selected>
												Last 30 days
											</option>
											<option value="90">
												Last 90 days
											</option>
											<option value="365">
												Last year
											</option>
										</select>
									</div>
								</div>
								<div class="mt-3">
									<button
										class="btn btn-info"
										onclick="getUserInsights()"
									>
										<i class="fas fa-analytics"></i> Analyze
										User Behavior
									</button>
								</div>
								<div
									class="result-area"
									id="insightsResult"
									style="display: none"
								>
									<h6>
										<i class="fas fa-chart-bar"></i> User
										Insights
									</h6>
									<div id="insightsList"></div>
								</div>
							</div>
						</div>

						<!-- Smart Search -->
						<div class="test-card">
							<div class="test-header">
								<h5 class="mb-0">
									<i class="fas fa-search"></i> Smart Search
									Suggestions
								</h5>
								<small
									>Get intelligent search suggestions based on
									user history</small
								>
							</div>
							<div class="test-body">
								<div class="row">
									<div class="col-md-6">
										<label class="form-label"
											>Search Query</label
										>
										<input
											type="text"
											class="form-control"
											id="searchQuery"
											placeholder="Enter search query (e.g., 'SGN to HAN')"
											value="SGN to HAN"
										/>
									</div>
									<div class="col-md-6">
										<label class="form-label"
											>Suggestion Type</label
										>
										<select
											class="form-control"
											id="suggestionType"
										>
											<option value="routes">
												Popular Routes
											</option>
											<option value="airports">
												Airport Suggestions
											</option>
											<option value="dates">
												Date Suggestions
											</option>
											<option value="prices">
												Price Trends
											</option>
										</select>
									</div>
								</div>
								<div class="mt-3">
									<button
										class="btn btn-warning"
										onclick="getSmartSuggestions()"
									>
										<i class="fas fa-lightbulb"></i> Get
										Smart Suggestions
									</button>
								</div>
								<div
									class="result-area"
									id="suggestionsResult"
									style="display: none"
								>
									<h6>
										<i class="fas fa-lightbulb"></i> Smart
										Suggestions
									</h6>
									<div id="suggestionsList"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			const API_BASE_URL = 'http://localhost:3000/api';
			let currentToken = '';

			// Show alert function
			function showAlert(message, type = 'info') {
				const alertContainer =
					document.getElementById('alertContainer');
				const alertId = 'alert-' + Date.now();

				const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" id="${alertId}" role="alert">
                    <i class="fas fa-${
						type === 'success'
							? 'check-circle'
							: type === 'danger'
							? 'exclamation-triangle'
							: 'info-circle'
					}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;

				alertContainer.innerHTML = alertHtml;

				setTimeout(() => {
					const alert = document.getElementById(alertId);
					if (alert) alert.remove();
				}, 5000);
			}

			// Test connection
			async function testConnection() {
				const token = document.getElementById('jwtToken').value.trim();
				if (!token) {
					showAlert('Please enter JWT token!', 'warning');
					return;
				}

				currentToken = token;
				showLoading(true);

				try {
					const response = await fetch(
						`${API_BASE_URL}/ai/insights/preferences`,
						{
							method: 'GET',
							headers: {
								Authorization: `Bearer ${token}`,
								'Content-Type': 'application/json',
							},
						}
					);

					if (response.ok) {
						showAlert(
							'✅ Connection successful! AI features are ready to test.',
							'success'
						);
					} else {
						throw new Error(
							`HTTP ${response.status}: ${response.statusText}`
						);
					}
				} catch (error) {
					showAlert(
						`❌ Connection failed: ${error.message}`,
						'danger'
					);
				} finally {
					showLoading(false);
				}
			}

			// Get personalized recommendations
			async function getPersonalizedRecommendations() {
				if (!currentToken) {
					showAlert('Please test connection first!', 'warning');
					return;
				}

				const departureAirport =
					document.getElementById('departureAirport').value;
				const arrivalAirport =
					document.getElementById('arrivalAirport').value;
				const departureDate =
					document.getElementById('departureDate').value;
				const travelClass =
					document.getElementById('travelClass').value;
				const limit = document.getElementById(
					'recommendationLimit'
				).value;

				showLoading(true);

				try {
					const params = new URLSearchParams({
						departure_airport_code: departureAirport,
						arrival_airport_code: arrivalAirport,
						departure_date: departureDate,
						class_code: travelClass,
						limit: limit,
					});

					const response = await fetch(
						`${API_BASE_URL}/ai/recommendations?${params}`,
						{
							method: 'GET',
							headers: {
								Authorization: `Bearer ${currentToken}`,
								'Content-Type': 'application/json',
							},
						}
					);

					const data = await response.json();

					if (data.success) {
						displayRecommendations(data.data.recommendations);
						showAlert(
							`✅ Found ${data.data.recommendations.length} AI recommendations!`,
							'success'
						);
					} else {
						throw new Error(
							data.message || 'Unable to get recommendations'
						);
					}
				} catch (error) {
					showAlert(`❌ Error: ${error.message}`, 'danger');
				} finally {
					showLoading(false);
				}
			}

			// Display recommendations
			function displayRecommendations(recommendations) {
				const resultArea = document.getElementById(
					'recommendationsResult'
				);
				const listContainer = document.getElementById(
					'recommendationsList'
				);

				if (!recommendations || recommendations.length === 0) {
					listContainer.innerHTML =
						'<p class="text-muted">No recommendations found.</p>';
				} else {
					let html = '';
					recommendations.forEach((rec, index) => {
						const score = rec.recommendation_score || 0;
						const scoreClass =
							score >= 80
								? 'score-high'
								: score >= 60
								? 'score-medium'
								: 'score-low';

						html += `
                        <div class="recommendation-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1">
                                        <i class="fas fa-plane"></i> ${
											rec.flight_number
										} - ${rec.airline_name}
                                    </h6>
                                    <p class="mb-2 text-muted">${
										rec.recommendation_reason ||
										'AI recommended based on your preferences'
									}</p>
                                </div>
                                <span class="score-badge ${scoreClass}">${score.toFixed(
							1
						)}%</span>
                            </div>
                            <div class="flight-info">
                                <div class="flight-detail">
                                    <strong>Departure</strong>
                                    <span>${rec.departure_airport} - ${
							rec.departure_city
						}</span>
                                    <br><small>${formatDateTime(
										rec.departure_time
									)}</small>
                                </div>
                                <div class="flight-detail">
                                    <strong>Arrival</strong>
                                    <span>${rec.arrival_airport} - ${
							rec.arrival_city
						}</span>
                                    <br><small>${formatDateTime(
										rec.arrival_time
									)}</small>
                                </div>
                                <div class="flight-detail">
                                    <strong>Price</strong>
                                    <span>${formatCurrency(
										rec.starting_price
									)} VND</span>
                                    <br><small>${rec.travel_class}</small>
                                </div>
                            </div>
                        </div>
                    `;
					});
					listContainer.innerHTML = html;
				}

				resultArea.style.display = 'block';
			}

			// Get booking assistance
			async function getBookingAssistance() {
				if (!currentToken) {
					showAlert('Please test connection first!', 'warning');
					return;
				}

				const flightId =
					document.getElementById('bookingFlightId').value;
				const passengers =
					document.getElementById('bookingPassengers').value;
				const travelClass =
					document.getElementById('bookingClass').value;

				showLoading(true);

				try {
					const response = await fetch(
						`${API_BASE_URL}/ai/booking-assistant`,
						{
							method: 'POST',
							headers: {
								Authorization: `Bearer ${currentToken}`,
								'Content-Type': 'application/json',
							},
							body: JSON.stringify({
								flight_id: parseInt(flightId),
								passengers: parseInt(passengers),
								travel_class: travelClass,
							}),
						}
					);

					const data = await response.json();

					if (data.success) {
						displayBookingAssistance(data.data);
						showAlert(
							'✅ Booking assistance generated!',
							'success'
						);
					} else {
						throw new Error(
							data.message || 'Unable to get booking assistance'
						);
					}
				} catch (error) {
					showAlert(`❌ Error: ${error.message}`, 'danger');
				} finally {
					showLoading(false);
				}
			}

			// Display booking assistance
			function displayBookingAssistance(assistance) {
				const resultArea = document.getElementById(
					'bookingAssistanceResult'
				);
				const listContainer = document.getElementById(
					'bookingAssistanceList'
				);

				let html = `
                <div class="recommendation-item">
                    <h6><i class="fas fa-info-circle"></i> Flight Information</h6>
                    <p><strong>Flight:</strong> ${assistance.flight_info.flight_number} - ${assistance.flight_info.airline_name}</p>
                    <p><strong>Route:</strong> ${assistance.flight_info.departure_airport} → ${assistance.flight_info.arrival_airport}</p>
                    <p><strong>Duration:</strong> ${assistance.flight_info.flight_duration}</p>
                </div>
            `;

				if (
					assistance.booking_tips &&
					assistance.booking_tips.length > 0
				) {
					html +=
						'<div class="recommendation-item"><h6><i class="fas fa-lightbulb"></i> AI Booking Tips</h6><ul>';
					assistance.booking_tips.forEach((tip) => {
						html += `<li>${tip}</li>`;
					});
					html += '</ul></div>';
				}

				if (assistance.price_analysis) {
					html += `
                    <div class="recommendation-item">
                        <h6><i class="fas fa-chart-line"></i> Price Analysis</h6>
                        <p><strong>Current Price:</strong> ${formatCurrency(
							assistance.price_analysis.current_price
						)} VND</p>
                        <p><strong>Trend:</strong> ${
							assistance.price_analysis.trend
						}</p>
                        <p><strong>Recommendation:</strong> ${
							assistance.price_analysis.recommendation
						}</p>
                    </div>
                `;
				}

				listContainer.innerHTML = html;
				resultArea.style.display = 'block';
			}

			// Get user insights
			async function getUserInsights() {
				if (!currentToken) {
					showAlert('Please test connection first!', 'warning');
					return;
				}

				const insightType =
					document.getElementById('insightType').value;
				const period = document.getElementById('insightPeriod').value;

				showLoading(true);

				try {
					const endpoint = `/ai/insights/${insightType}?days=${period}`;
					const response = await fetch(`${API_BASE_URL}${endpoint}`, {
						method: 'GET',
						headers: {
							Authorization: `Bearer ${currentToken}`,
							'Content-Type': 'application/json',
						},
					});

					const data = await response.json();

					if (data.success) {
						displayInsights(data.data, insightType);
						showAlert('✅ User insights generated!', 'success');
					} else {
						throw new Error(
							data.message || 'Unable to get insights'
						);
					}
				} catch (error) {
					showAlert(`❌ Error: ${error.message}`, 'danger');
				} finally {
					showLoading(false);
				}
			}

			// Display insights
			function displayInsights(insights, type) {
				const resultArea = document.getElementById('insightsResult');
				const listContainer = document.getElementById('insightsList');

				let html = '';

				switch (type) {
					case 'preferences':
						html = `
                        <div class="recommendation-item">
                            <h6><i class="fas fa-heart"></i> Travel Preferences</h6>
                            <p><strong>Preferred Class:</strong> ${
								insights.preferred_class || 'Economy'
							}</p>
                            <p><strong>Preferred Airlines:</strong> ${
								insights.preferred_airlines?.join(', ') ||
								'None'
							}</p>
                            <p><strong>Preferred Routes:</strong> ${
								insights.preferred_routes?.join(', ') || 'None'
							}</p>
                            <p><strong>Travel Frequency:</strong> ${
								insights.travel_frequency || 'Unknown'
							}</p>
                        </div>
                    `;
						break;
					case 'patterns':
						html = `
                        <div class="recommendation-item">
                            <h6><i class="fas fa-chart-line"></i> Travel Patterns</h6>
                            <p><strong>Most Searched Routes:</strong></p>
                            <ul>
                                ${
									insights.popular_routes
										?.map(
											(route) =>
												`<li>${route.route} (${route.count} searches)</li>`
										)
										.join('') ||
									'<li>No data available</li>'
								}
                            </ul>
                            <p><strong>Booking Patterns:</strong> ${
								insights.booking_patterns ||
								'No patterns detected'
							}</p>
                        </div>
                    `;
						break;
					case 'recommendations':
						html = `
                        <div class="recommendation-item">
                            <h6><i class="fas fa-star"></i> Recommendation History</h6>
                            <p><strong>Total Recommendations:</strong> ${
								insights.total_recommendations || 0
							}</p>
                            <p><strong>Average Score:</strong> ${
								insights.average_score?.toFixed(1) || 'N/A'
							}%</p>
                            <p><strong>Most Recommended Airlines:</strong> ${
								insights.top_airlines?.join(', ') || 'None'
							}</p>
                        </div>
                    `;
						break;
					case 'search_history':
						html = `
                        <div class="recommendation-item">
                            <h6><i class="fas fa-search"></i> Search History</h6>
                            <p><strong>Total Searches:</strong> ${
								insights.total_searches || 0
							}</p>
                            <p><strong>Recent Searches:</strong></p>
                            <ul>
                                ${
									insights.recent_searches
										?.map(
											(search) =>
												`<li>${
													search.route
												} on ${formatDate(
													search.date
												)}</li>`
										)
										.join('') ||
									'<li>No recent searches</li>'
								}
                            </ul>
                        </div>
                    `;
						break;
				}

				listContainer.innerHTML = html;
				resultArea.style.display = 'block';
			}

			// Get smart suggestions
			async function getSmartSuggestions() {
				if (!currentToken) {
					showAlert('Please test connection first!', 'warning');
					return;
				}

				const query = document.getElementById('searchQuery').value;
				const type = document.getElementById('suggestionType').value;

				showLoading(true);

				try {
					const response = await fetch(
						`${API_BASE_URL}/ai/search-suggestions?query=${encodeURIComponent(
							query
						)}&limit=5`,
						{
							method: 'GET',
							headers: {
								Authorization: `Bearer ${currentToken}`,
								'Content-Type': 'application/json',
							},
						}
					);

					const data = await response.json();

					if (data.success) {
						displaySuggestions(data.data.suggestions, type);
						showAlert('✅ Smart suggestions generated!', 'success');
					} else {
						throw new Error(
							data.message || 'Unable to get suggestions'
						);
					}
				} catch (error) {
					showAlert(`❌ Error: ${error.message}`, 'danger');
				} finally {
					showLoading(false);
				}
			}

			// Display suggestions
			function displaySuggestions(suggestions, type) {
				const resultArea = document.getElementById('suggestionsResult');
				const listContainer =
					document.getElementById('suggestionsList');

				let html = '';

				if (!suggestions || suggestions.length === 0) {
					html =
						'<p class="text-muted">No suggestions available.</p>';
				} else {
					html =
						'<div class="recommendation-item"><h6><i class="fas fa-lightbulb"></i> Smart Suggestions</h6><ul>';
					suggestions.forEach((suggestion) => {
						html += `<li>${suggestion}</li>`;
					});
					html += '</ul></div>';
				}

				listContainer.innerHTML = html;
				resultArea.style.display = 'block';
			}

			// Utility functions
			function showLoading(show) {
				document.getElementById('loadingIndicator').style.display = show
					? 'block'
					: 'none';
			}

			function formatDateTime(dateString) {
				if (!dateString) return 'N/A';
				const date = new Date(dateString);
				return date.toLocaleString('vi-VN');
			}

			function formatDate(dateString) {
				if (!dateString) return 'N/A';
				const date = new Date(dateString);
				return date.toLocaleDateString('vi-VN');
			}

			function formatCurrency(amount) {
				return new Intl.NumberFormat('vi-VN').format(amount);
			}

			// Auto-test connection on page load
			document.addEventListener('DOMContentLoaded', function () {
				const tokenInput = document.getElementById('jwtToken');
				if (tokenInput.value.trim()) {
					setTimeout(() => {
						testConnection();
					}, 1000);
				}
			});
		</script>
	</body>
</html>
